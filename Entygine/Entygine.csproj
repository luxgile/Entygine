<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup>
		<OutputType>Library</OutputType>
		<TargetFramework>net5.0</TargetFramework>
		<LangVersion>preview</LangVersion>
		<Platforms>AnyCPU;x64;x86</Platforms>
		<EmitCompilerGeneratedFiles>true</EmitCompilerGeneratedFiles>
		<CompilerGeneratedFilesOutputPath>$(BaseIntermediateOutputPath)\GeneratedFiles</CompilerGeneratedFilesOutputPath>
	</PropertyGroup>

	<!--<Target Name="AddSourceGeneratedFiles" AfterTargets="CoreCompile">
    <ItemGroup>
      <Compile Include="$(BaseIntermediateOutputPath)\GeneratedFiles\**" />
    </ItemGroup>
  </Target>-->
  <!--<Target Name="RemoveSourceGeneratedFiles" BeforeTargets="CoreCompile">
    <ItemGroup>
      <Compile Remove="$(BaseIntermediateOutputPath)\GeneratedFiles\**" />
    </ItemGroup>
  </Target>
  <Target Name="CleanSourceGeneratedFiles" AfterTargets="Clean">
    <RemoveDir Directories="$(BaseIntermediateOutputPath)\GeneratedFiles" />
  </Target>-->

	<!--
	This workaround is not recommended for general use.
	I basically include this from Directory.Build.targets.
	If you actually use this I *highly* recommend you disable the Delete task in Roslyn46966And49125Workaround
	and sanity-check that it is going to do the right thing using https://msbuildlog.com/
    As a workaround for https://github.com/dotnet/roslyn/issues/44093 we skip source generators for design-time builds
    and emit generated files and include them for design-time builds.
	-->
	<!--<Target Name="Roslyn44093Workaround" BeforeTargets="CoreCompile;ResolveProjectReferences;$(PrepareProjectReferencesDependsOn)" Condition="'$(DesignTimeBuild)' == 'true'">
		<ItemGroup>
			 This is slightly over-zealous since it removes in-solution analyzers too 
			<_AnalyzerProjectReferencesToRemove Include="@(ProjectReference)" Condition="'%(OutputItemType)' == 'Analyzer'" />
			<ProjectReference Remove="@(_AnalyzerProjectReferencesToRemove)" />

			<Compile Include="$(CompilerGeneratedFilesOutputPath)/%(_AnalyzerProjectReferencesToRemove.FileName)/**/*.cs" Visible="false" />
		</ItemGroup>
	</Target>
	 Workaround for https://github.com/dotnet/roslyn/issues/47966 and https://github.com/dotnet/roslyn/issues/49125 
	<Target Name="Roslyn46966And49125Workaround" BeforeTargets="CoreCompile;Clean" Condition="'$(DesignTimeBuild)' != 'true' and '$(CompilerGeneratedFilesOutputPath)' != ''">
		<ItemGroup>
			<_GeneratedSourceFileToRemove Include="$(CompilerGeneratedFilesOutputPath)/**/*.cs" />
		</ItemGroup>
		<Delete Files="@(_GeneratedSourceFileToRemove)" />
	</Target>-->

	<ItemGroup>
		<ProjectReference Include="..\Entygine.SourceGen\Entygine.SourceGen.csproj" OutputItemType="Analyzer" ReferenceOutputAssembly="false" />
	</ItemGroup>

	<!-- Fix for IDE to make intellisense working-->
	<ItemGroup>
    <Compile Include="$(IntermediateOutputPath)*.gen.cs" Condition="'$(DesignTimeBuild)' == 'true'" Link="%(Filename)%(Extension)" Visible="false" />
  </ItemGroup>

	<PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|AnyCPU'">
		<AllowUnsafeBlocks>true</AllowUnsafeBlocks>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x86'">
		<AllowUnsafeBlocks>true</AllowUnsafeBlocks>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
		<AllowUnsafeBlocks>true</AllowUnsafeBlocks>
		<DebugType>full</DebugType>
		<DebugSymbols>true</DebugSymbols>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|AnyCPU'">
		<AllowUnsafeBlocks>true</AllowUnsafeBlocks>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x86'">
		<AllowUnsafeBlocks>true</AllowUnsafeBlocks>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
		<AllowUnsafeBlocks>true</AllowUnsafeBlocks>
	</PropertyGroup>

	<ItemGroup>
		<PackageReference Include="Microsoft.Win32.SystemEvents" Version="5.0.0" />
		<PackageReference Include="OpenTK" Version="4.6.3" />
		<PackageReference Include="SharpFont" Version="4.0.1" />
		<PackageReference Include="SharpFont.Dependencies" Version="2.6.0" />
		<PackageReference Include="SharpFont.Dependencies.x64" Version="2.6.0" />
		<PackageReference Include="SixLabors.ImageSharp" Version="1.0.3" />
		<PackageReference Include="System.Drawing.Common" Version="4.7.0" />

		<!--<CompilerVisibleProperty Include="IntermediateOutputPath" />-->
	</ItemGroup>

	<ItemGroup>
		<Folder Include="Assets\Fonts\" />
		<Folder Include="Assets\Textures\" />
	</ItemGroup>


	<ItemGroup>
		<Reference Include="SharpFont">
			<HintPath>Dependencies\SharpFont.dll</HintPath>
		</Reference>
	</ItemGroup>

	<ItemGroup>
		<Service Include="{508349b6-6b84-4df5-91f0-309beebad82d}" />
	</ItemGroup>

	<!--<ItemGroup>
    <Compile Update="Scripts\ECS Architecture\Iteration\EntityIterator_Iterations.gen.cs">
      <DesignTime>True</DesignTime>
      <AutoGen>True</AutoGen>
      <DependentUpon>EntityIterator_Iterations.gen.tt</DependentUpon>
    </Compile>
  </ItemGroup>

  <ItemGroup>
    <None Update="Scripts\ECS Architecture\Iteration\EntityIterator_Iterations.gen.tt">
      <Generator>TextTemplatingFileGenerator</Generator>
      <LastGenOutput>EntityIterator_Iterations.gen.cs</LastGenOutput>
    </None>
  </ItemGroup>-->

</Project>
